<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InsightHub Dashboard</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>InsightHub Dashboard</h1>
            <div class="header-actions">
                <span id="last-updated">Loading...</span>
                <button onclick="refreshData()" class="btn btn-primary">â†» Refresh</button>
                <select id="refresh-interval" onchange="changeRefreshInterval()">
                    <option value="0">Manual</option>
                    <option value="10000">10s</option>
                    <option value="30000">30s</option>
                    <option value="60000" selected>1 min</option>
                    <option value="120000">2 min</option>
                    <option value="300000">5 min</option>
                </select>
                <a href="/export" class="btn btn-secondary">Export CSV</a>
            </div>
        </header>

        <!-- Overview Stats -->
        <section class="stats-grid" id="overview-stats">
            <div class="stat-card">
                <h3>Source Total</h3>
                <div class="stat-value" id="source-total">-</div>
                <div class="stat-label">results table</div>
            </div>
            <div class="stat-card">
                <h3>Enriched</h3>
                <div class="stat-value" id="enriched-total">-</div>
                <div class="stat-label">zen_contacts</div>
            </div>
            <div class="stat-card highlight">
                <h3>Pending</h3>
                <div class="stat-value" id="pending-total">-</div>
                <div class="stat-label">awaiting processing</div>
            </div>
            <div class="stat-card success">
                <h3>Success Rate</h3>
                <div class="stat-value" id="success-rate">-</div>
                <div class="stat-label">of processed</div>
            </div>
        </section>

        <!-- Contact Stats -->
        <section class="stats-grid stats-grid-5" id="contact-stats">
            <div class="stat-card">
                <h3>Emails Found</h3>
                <div class="stat-value" id="total-emails">-</div>
                <div class="stat-label" id="rows-with-email">- rows</div>
            </div>
            <div class="stat-card">
                <h3>Phones Found</h3>
                <div class="stat-value" id="total-phones">-</div>
                <div class="stat-label" id="rows-with-phone">- rows</div>
            </div>
            <div class="stat-card">
                <h3>WhatsApp Found</h3>
                <div class="stat-value" id="total-whatsapp">-</div>
                <div class="stat-label" id="rows-with-whatsapp">- rows</div>
            </div>
            <div class="stat-card">
                <h3>Social Media</h3>
                <div class="stat-value" id="total-social">-</div>
                <div class="stat-label" id="rows-with-social">- rows</div>
            </div>
            <div class="stat-card">
                <h3>Last 24h</h3>
                <div class="stat-value" id="processed-24h">-</div>
                <div class="stat-label" id="processed-1h">- last hour</div>
            </div>
        </section>

        <!-- Server Status -->
        <section class="card" id="servers-section">
            <h2>Server Status <span class="badge" id="servers-online">0 online</span></h2>
            <div class="table-container">
                <table id="servers-table">
                    <thead>
                        <tr>
                            <th>Server</th>
                            <th>Region</th>
                            <th>Status</th>
                            <th>Health</th>
                            <th>Processed</th>
                            <th>Rate</th>
                            <th>Success %</th>
                            <th>Last Activity</th>
                        </tr>
                    </thead>
                    <tbody id="servers-body">
                        <tr><td colspan="8" class="loading">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Country Progress -->
        <section class="card" id="countries-section">
            <h2>Country Progress <span class="badge" id="countries-count">0 countries</span></h2>
            <div class="table-container">
                <table id="countries-table">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="country_code" onclick="sortCountries('country_code')">Country</th>
                            <th class="sortable" data-sort="source_total" onclick="sortCountries('source_total')">Source</th>
                            <th class="sortable" data-sort="enriched_total" onclick="sortCountries('enriched_total')">Enriched</th>
                            <th class="sortable" data-sort="pending" onclick="sortCountries('pending')">Pending</th>
                            <th class="sortable" data-sort="progress_percent" onclick="sortCountries('progress_percent')">Progress</th>
                            <th class="sortable" data-sort="emails_total" onclick="sortCountries('emails_total')">Emails</th>
                            <th class="sortable" data-sort="whatsapp_total" onclick="sortCountries('whatsapp_total')">WhatsApp</th>
                            <th class="sortable" data-sort="avg_scrape_time" onclick="sortCountries('avg_scrape_time')">Avg Time</th>
                        </tr>
                    </thead>
                    <tbody id="countries-body">
                        <tr><td colspan="8" class="loading">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Recent Activity -->
        <section class="card" id="activity-section">
            <h2>Recent Activity</h2>
            <div class="table-container">
                <table id="activity-table">
                    <thead>
                        <tr>
                            <th>Business</th>
                            <th>Country</th>
                            <th>Status</th>
                            <th>Emails</th>
                            <th>Phones</th>
                            <th>WA</th>
                            <th>Time</th>
                            <th>Updated</th>
                        </tr>
                    </thead>
                    <tbody id="activity-body">
                        <tr><td colspan="8" class="loading">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- Server Detail Modal -->
    <div id="server-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Server Details</h2>
                <button class="modal-close" onclick="closeServerModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h3>Identity</h3>
                    <div class="modal-grid">
                        <div class="modal-item"><span class="label">Server ID:</span> <span id="modal-server-id">-</span></div>
                        <div class="modal-item"><span class="label">Name:</span> <span id="modal-server-name">-</span></div>
                        <div class="modal-item"><span class="label">IP Address:</span> <span id="modal-server-ip">-</span></div>
                        <div class="modal-item"><span class="label">Hostname:</span> <span id="modal-server-hostname">-</span></div>
                        <div class="modal-item"><span class="label">Region:</span> <span id="modal-server-region">-</span></div>
                    </div>
                </div>
                <div class="modal-section">
                    <h3>Status</h3>
                    <div class="modal-grid">
                        <div class="modal-item"><span class="label">Status:</span> <span id="modal-server-status">-</span></div>
                        <div class="modal-item"><span class="label">Health:</span> <span id="modal-server-health">-</span></div>
                        <div class="modal-item"><span class="label">Workers:</span> <span id="modal-server-workers">-</span></div>
                        <div class="modal-item"><span class="label">Current Task:</span> <span id="modal-server-task">-</span></div>
                    </div>
                </div>
                <div class="modal-section">
                    <h3>Statistics (All Time)</h3>
                    <div class="modal-grid">
                        <div class="modal-item"><span class="label">Total Processed:</span> <span id="modal-server-processed">-</span></div>
                        <div class="modal-item"><span class="label">Success:</span> <span id="modal-server-success">-</span></div>
                        <div class="modal-item"><span class="label">Failed:</span> <span id="modal-server-failed">-</span></div>
                        <div class="modal-item"><span class="label">Rate:</span> <span id="modal-server-rate">-</span></div>
                        <div class="modal-item"><span class="label">Success Rate:</span> <span id="modal-server-success-rate">-</span></div>
                    </div>
                </div>
                <div class="modal-section">
                    <h3>Current Session</h3>
                    <div class="modal-grid">
                        <div class="modal-item"><span class="label">Session Processed:</span> <span id="modal-server-session-processed">-</span></div>
                        <div class="modal-item"><span class="label">Session Errors:</span> <span id="modal-server-session-errors">-</span></div>
                        <div class="modal-item"><span class="label">Session Started:</span> <span id="modal-server-session-started">-</span></div>
                    </div>
                </div>
                <div class="modal-section">
                    <h3>Timestamps</h3>
                    <div class="modal-grid">
                        <div class="modal-item"><span class="label">First Started:</span> <span id="modal-server-started">-</span></div>
                        <div class="modal-item"><span class="label">Last Heartbeat:</span> <span id="modal-server-heartbeat">-</span></div>
                        <div class="modal-item"><span class="label">Last Activity:</span> <span id="modal-server-activity">-</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/dashboard.js"></script>
</body>
</html>
